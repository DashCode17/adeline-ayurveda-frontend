<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="D√©couvrez les t√©moignages de mes clients sur leurs exp√©riences de massages ayurv√©diques. Avis authentiques et mod√©r√©s.">
  <title>T√©moignages ‚Äî Adeline Ayurveda</title>

  <!-- Styles CSS -->
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/reviews-slider.css">

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="assets/logo.svg">

  <!-- Cloudflare Web Analytics -->
  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "e563a25433024fd297a1bca5a170a8b1"}'></script>
  <!-- End Cloudflare Web Analytics -->
</head>
<body class="site-wrapper">

  <!-- Overlay menu mobile -->
  <div class="nav-overlay"></div>

  <!-- HEADER -->
  <header class="site-header">
    <div class="container">
      <div class="header-inner">
        <a href="index.html" class="site-logo">
          <img src="assets/logo.svg" alt="Logo Adeline Ayurveda">
          <div class="site-title">
              <span class="title-main">Adeline Ayurveda</span>
              <span class="title-tagline">Un pas vers soi</span>
            </div>
        </a>

        <!-- Bouton hamburger (mobile/tablette) -->
        <button class="nav-toggle" aria-label="Ouvrir le menu" aria-expanded="false">
          <div class="nav-toggle-icon">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </button>

        <nav class="main-nav" aria-label="Navigation principale">
          <ul>
            <li><a href="index.html">Accueil</a></li>
            <li><a href="ayurveda.html">Qu'est-ce que l'Ayurv√©da</a></li>
            <li><a href="prestations.html">Mes Prestations</a></li>
            <li><a href="avis.html" class="active">T√©moignages</a></li>
            <li><a href="contact.html">Contact</a></li>
          </ul>
        </nav>
      </div>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main>
    <section>
      <div class="container">
        <h1>üí¨ T√©moignages</h1>

        <div class="container-narrow">
          <p class="text-center text-muted mb-lg">
            D√©couvrez les avis de personnes ayant b√©n√©fici√© de mes soins.<br>
            Tous les t√©moignages sont publi√©s apr√®s mod√©ration.
          </p>

          <div class="text-center mb-lg">
            <a href="laisser-un-avis.html" class="btn btn-primary">Laisser un avis</a>
          </div>
        </div>

        <!-- Liste des t√©moignages (peupl√©e par JS) -->
        <div class="cards-grid" id="reviewsList">
          <!-- Fallback si JS d√©sactiv√© -->
          <div class="card">
            <div class="card-body text-center">
              <p class="text-muted">
                Chargement des t√©moignages en cours...<br>
                Veuillez activer JavaScript pour voir les avis.
              </p>
            </div>
          </div>
        </div>

        <!-- Message si aucun avis -->
        <div id="noReviewsMessage" class="container-narrow text-center mt-lg" style="display: none;">
          <div class="message message-info">
            <p><strong>Aucun t√©moignage pour le moment.</strong></p>
            <p>Soyez le premier √† partager votre exp√©rience !</p>
            <a href="laisser-un-avis.html" class="btn btn-primary mt-sm">Laisser un avis</a>
          </div>
        </div>

        <!-- Message d'erreur API -->
        <div id="errorMessage" class="container-narrow mt-lg" style="display: none;">
          <div class="message message-error">
            <p><strong>Une erreur est survenue lors du chargement des t√©moignages.</strong></p>
            <p>Veuillez r√©essayer ult√©rieurement.</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3>Adeline Ayurveda<br /><span style="font-family: var(--font-body); font-size: var(--font-size-sm); font-weight: normal;">Un pas vers soi</span></h3>
          <p>
            Praticienne en massage bien-√™tre ayurv√©dique.<br>
          </p>
        </div>
        <div class="footer-section">
          <h3>Navigation</h3>
          <nav aria-label="Navigation footer">
            <a href="index.html">Accueil</a><br>
            <a href="ayurveda.html">Qu'est-ce que l'Ayurv√©da</a><br>
            <a href="prestations.html">Mes Prestations</a><br>
            <a href="avis.html">T√©moignages</a><br>
            <a href="contact.html">Contact</a>
          </nav>
        </div>
        <div class="footer-section">
          <h3>Informations l√©gales</h3>
          <p>
            Vos donn√©es sont prot√©g√©es par le R√®glement G√©n√©ral sur la Protection des Donn√©es (RGPD).<br>
            Droit de retrait des t√©moignages :<br />
              Si vous souhaitez retirer votre t√©moignage publi√© sur ce site, contactez-moi au 07 56 93 10 76 et votre avis sera supprim√© dans les plus brefs d√©lais.<br>
            Site h√©berg√© par GitHub Pages
          </p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; <span id="currentYear"></span> Adeline Ayurveda ‚Äî Tous droits r√©serv√©s</p>
      </div>
    </div>
  </footer>

  <!-- Scripts JS -->
  <script src="js/menu-hamburger.js" defer></script>
  <script src="js/api.js" defer></script>
  <script>
    // Script inline pour charger la liste des avis
    // @version 1.2.0 - Fix affichage entit√©s HTML (2026-01-17)
    document.addEventListener('DOMContentLoaded', async () => {
      const reviewsList = document.getElementById('reviewsList');
      const noReviewsMessage = document.getElementById('noReviewsMessage');
      const errorMessage = document.getElementById('errorMessage');

      try {
        // Fetch reviews (api.js fournit la fonction fetchReviews)
        const reviews = await window.API.fetchReviews();

        // Vider le fallback
        reviewsList.innerHTML = '';

        if (reviews.length === 0) {
          // Aucun avis
          noReviewsMessage.style.display = 'block';
        } else {
          // Afficher les avis
          reviews.forEach(review => {
            const card = createReviewCard(review);
            reviewsList.appendChild(card);
          });

          // Scroll automatique vers l'avis cibl√© si anchor dans l'URL
          scrollToTargetReview();
        }
      } catch (error) {
        // Erreur API
        reviewsList.innerHTML = '';
        errorMessage.style.display = 'block';
        console.error('Erreur chargement avis:', error);
      }
    });

    // Fonction pour formater la date en r√©f√©rence temporelle relative
    function formatRelativeDate(dateString) {
      if (!dateString) return '';

      const date = new Date(dateString);
      const now = new Date();

      // Calculer la diff√©rence en millisecondes
      const diffMs = now - date;
      const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
      const diffWeeks = Math.floor(diffDays / 7);
      const diffYears = Math.floor(diffDays / 365);

      // Aujourd'hui
      if (diffDays === 0) return 'Aujourd\'hui';

      // Hier
      if (diffDays === 1) return 'Hier';

      // Il y a X jours (< 7 jours)
      if (diffDays < 7) return `Il y a ${diffDays} jour${diffDays > 1 ? 's' : ''}`;

      // Il y a X semaines (< 52 semaines)
      if (diffWeeks < 52) return `Il y a ${diffWeeks} semaine${diffWeeks > 1 ? 's' : ''}`;

      // Il y a 1 an
      if (diffYears === 1) return 'Il y a 1 an';

      // Il y a X ans
      return `Il y a ${diffYears} ans`;
    }

    // Fonction pour cr√©er une card d'avis
    function createReviewCard(review) {
      const card = document.createElement('div');
      card.className = 'card';
      card.id = `review-${review.id}`; // ID unique pour ancre de lien

      // √âtoiles
      const stars = '‚òÖ'.repeat(review.rating) + '‚òÜ'.repeat(5 - review.rating);

      // Formater la date relative
      const relativeDate = formatRelativeDate(review.approvedAt);
      const dateText = relativeDate ? ` (${relativeDate})` : '';

      // Affichage ville (optionnel, pour r√©trocompatibilit√©)
      const cityText = review.city ? ` - ${decodeHTMLEntities(review.city)}` : '';

      card.innerHTML = `
        <div class="card-header">
          <div class="review-rating" style="font-size: var(--font-size-md);">
            ${stars}
          </div>
        </div>
        <div class="card-body">
          <p style="font-style: italic; line-height: 1.7;">${decodeHTMLEntities(review.message)}</p>
        </div>
        <div class="card-footer">
          <span style="font-style: italic; color: var(--color-secondary-1);">${decodeHTMLEntities(review.name)}${dateText}${cityText}</span>
        </div>
      `;

      return card;
    }

    // Scroll automatique vers l'avis cibl√© si anchor dans l'URL
    function scrollToTargetReview() {
      const hash = window.location.hash;
      if (hash && hash.startsWith('#review-')) {
        setTimeout(() => {
          const targetElement = document.querySelector(hash);
          if (targetElement) {
            targetElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            // Ajouter une animation pour mettre en √©vidence l'avis cibl√©
            targetElement.style.transition = 'box-shadow 0.3s ease';
            targetElement.style.boxShadow = '0 0 0 3px var(--color-accent-3)';
            setTimeout(() => {
              targetElement.style.boxShadow = '';
            }, 2000);
          }
        }, 300); // Attendre que les avis soient rendus
      }
    }

    // D√©code les entit√©s HTML (pour afficher correctement le texte du backend)
    // Le backend encode d√©j√† les caract√®res sp√©ciaux, on doit les d√©coder pour l'affichage
    function decodeHTMLEntities(str) {
      if (typeof str !== 'string') return str;
      const textarea = document.createElement('textarea');
      textarea.innerHTML = str;
      return textarea.value;
    }
  </script>
    <!-- Mise √† jour automatique de l'ann√©e dans le footer -->
    <script>
      document.getElementById("currentYear").textContent = new Date().getFullYear();
    </script>
  </body>
</html>
